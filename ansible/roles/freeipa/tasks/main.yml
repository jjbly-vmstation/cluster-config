---
# FreeIPA Container Bootstrap
- name: Pull FreeIPA container image
  ansible.builtin.command:
    cmd: ctr images pull quay.io/freeipa/freeipa-server:latest
  changed_when: false
  tags: [freeipa, sso, baseline]

- name: Run FreeIPA container (host networking, correct ctr syntax)
  ansible.builtin.command:
    # ctr does not support --name or -p; use host networking and positional name
    cmd: ctr run --detach --net-host quay.io/freeipa/freeipa-server:latest freeipa-server /usr/sbin/init
  changed_when: false
  tags: [freeipa, sso, baseline]

- name: Wait for FreeIPA LDAP to be reachable
  ansible.builtin.wait_for:
    port: 389
    host: localhost
    timeout: 120
  tags: [freeipa, sso, baseline]
