# {{ ansible_managed | default('Managed by Ansible') }}
# Chrony configuration file
# Generated for {{ inventory_hostname }}

# NTP servers
{% for server in ntp_servers | default(['0.pool.ntp.org', '1.pool.ntp.org', '2.pool.ntp.org', '3.pool.ntp.org']) %}
server {{ server }}{% if chrony_iburst | default(true) %} iburst{% endif %}

{% endfor %}

# Drift file - records the rate at which the system clock gains/loses time
driftfile {{ chrony_drift_file | default('/var/lib/chrony/drift') }}

# Enable kernel synchronization of the real-time clock (RTC)
{% if chrony_rtcsync | default(true) %}
rtcsync
{% endif %}

# Allow large time correction on startup
# makestep <threshold> <limit>
makestep {{ chrony_makestep_threshold | default(1.0) }} {{ chrony_makestep_limit | default(3) }}

{% if chrony_is_server | default(false) %}
# Allow NTP client access from local network
{% for network in chrony_allow_networks | default([]) %}
allow {{ network }}
{% endfor %}

# Serve time even when not synchronized
local stratum 10
{% endif %}

# Log files location
logdir {{ chrony_log_dir | default('/var/log/chrony') }}

# Log selection for debugging
# log measurements statistics tracking

# Keyfile for NTP authentication (optional)
{% if chrony_key_file is defined %}
keyfile {{ chrony_key_file }}
{% endif %}

{% if chrony_hwtimestamp_enable | default(false) %}
# Hardware timestamping for better accuracy
hwtimestamp *
{% endif %}

# Leap seconds handling
{% if chrony_leapsectz is defined %}
leapsectz {{ chrony_leapsectz }}
{% endif %}
