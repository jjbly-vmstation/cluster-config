---
# Keycloak Container Bootstrap
- name: Pull Keycloak container image
  ansible.builtin.command:
    cmd: ctr images pull quay.io/keycloak/keycloak:latest
  changed_when: false
  tags: [keycloak, sso, baseline]

- name: Run Keycloak container (host networking, correct ctr syntax)
  ansible.builtin.command:
    # ctr does not support --name or -p; use host networking and positional name
    cmd: ctr run --detach --net-host quay.io/keycloak/keycloak:latest keycloak-server /opt/keycloak/bin/kc.sh start-dev
  changed_when: false
  tags: [keycloak, sso, baseline]

- name: Wait for Keycloak to be reachable
  ansible.builtin.wait_for:
    port: 8080
    host: localhost
    timeout: 120
  tags: [keycloak, sso, baseline]
