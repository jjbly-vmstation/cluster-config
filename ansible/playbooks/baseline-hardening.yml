---
# Baseline Security Hardening Playbook (Role-based)
# Usage:
#   ansible-playbook -i /srv/vmstation-org/cluster-setup/ansible/inventory/hosts.yml playbooks/baseline-hardening.yml

- name: Apply Baseline Security Hardening
  hosts: all
  become: true
  gather_facts: true

  roles:
    - baseline_hardening

  post_tasks:
    - name: Verify SSH configuration
      ansible.builtin.command:
        cmd: sshd -t
      register: ssh_test
      changed_when: false
      failed_when: false
      tags: [verify]

    - name: Display hardening summary
      ansible.builtin.debug:
        msg: |
          ========================================
          Security Hardening Complete for {{ inventory_hostname }}
          ========================================
          SSH Config Test: {{ 'PASSED' if ssh_test.rc == 0 else 'FAILED' }}
          ========================================
