# {{ ansible_managed | default('Managed by Ansible') }}
# SSH Hardening Configuration
# Template: ssh_hardening.conf.j2

# Protocol version - SSH version 2 only
Protocol 2

# Strong key exchange algorithms
KexAlgorithms {{ ssh_kex_algorithms | default(['curve25519-sha256', 'curve25519-sha256@libssh.org', 'diffie-hellman-group-exchange-sha256']) | join(',') }}

# Strong ciphers only
Ciphers {{ ssh_ciphers | default(['chacha20-poly1305@openssh.com', 'aes256-gcm@openssh.com', 'aes128-gcm@openssh.com', 'aes256-ctr', 'aes192-ctr', 'aes128-ctr']) | join(',') }}

# Strong MAC algorithms
MACs {{ ssh_macs | default(['hmac-sha2-512-etm@openssh.com', 'hmac-sha2-256-etm@openssh.com', 'hmac-sha2-512', 'hmac-sha2-256']) | join(',') }}

# Authentication settings
PermitRootLogin {{ ssh_permit_root_login | default('prohibit-password') }}
PasswordAuthentication {{ ssh_password_auth | default('no') }}
PermitEmptyPasswords {{ ssh_permit_empty_passwords | default('no') }}
MaxAuthTries {{ ssh_max_auth_tries | default(3) }}
MaxSessions {{ ssh_max_sessions | default(10) }}

# Disable features that are not needed
X11Forwarding {{ 'yes' if ssh_x11_forwarding | default(false) else 'no' }}
AllowAgentForwarding {{ 'yes' if ssh_agent_forwarding | default(false) else 'no' }}
AllowTcpForwarding {{ 'yes' if ssh_tcp_forwarding | default(false) else 'no' }}
PermitTunnel {{ 'yes' if ssh_permit_tunnel | default(false) else 'no' }}

# Logging
SyslogFacility {{ ssh_syslog_facility | default('AUTH') }}
LogLevel {{ ssh_log_level | default('VERBOSE') }}

# Client keepalive and timeout
ClientAliveInterval {{ ssh_client_alive_interval | default(300) }}
ClientAliveCountMax {{ ssh_client_alive_count_max | default(2) }}
LoginGraceTime {{ ssh_login_grace_time | default(60) }}

# Show login banner
Banner /etc/issue.net

# Disable insecure authentication methods
ChallengeResponseAuthentication no
GSSAPIAuthentication no
HostbasedAuthentication no
